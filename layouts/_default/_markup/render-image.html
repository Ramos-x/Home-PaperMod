{{- $respSizes := slice 720 1080 -}}
{{- $dataSizes := "(min-width: 720px) 720px, 100vw" -}}

{{- $holder := "GIP" -}}
{{- $hint := "q85" -}}
{{- $filter := "Lanczos" -}}

{{- $Destination := .Destination -}}
{{- $Text := .Text -}}
{{- $Title := .Title -}}

{{- $responsiveImages := (.Page.Params.responsiveImages | default site.Params.responsiveImages) | default true }}

{{ with $src := .Page.Resources.GetMatch .Destination }}
    {{- if $responsiveImages -}}
        <picture>
            {{- if and hugo.IsExtended (ne $src.MediaType.Type "image/webp") -}}
            <source type="image/webp" srcset="
            {{- with $respSizes -}}
                {{- range $i, $e := . -}}
                    {{- if $i }}, {{ end -}}{{- ($src.Resize (print . "x webp " $hint " " $filter) ).RelPermalink | absURL }} {{ . }}w
                {{- end -}}
            {{- end -}}" sizes="{{ $dataSizes }}" />
            {{- end -}}
            <source type="{{ $src.MediaType.Type }}" srcset="
            {{- with $respSizes -}}
                {{- range $i, $e := . -}}
                    {{- if ge $src.Width . -}}
                        {{- if $i }}, {{ end -}}{{- ($src.Resize (print . "x jpg " $filter) ).RelPermalink | absURL}} {{ . }}w
                    {{- end -}}
                {{- end -}}
            {{- end -}}, {{$src.Permalink }} {{printf "%dw" ($src.Width)}}" sizes="{{ $dataSizes }}" />
            <img src="{{ $Destination | safeURL }}" width="{{ .Width }}" height="{{ .Height }}" alt="{{ $Text }}" title="{{ $Title }}" loading="lazy" />
        </picture>
        {{- else }}
        <img src="{{ $Destination | safeURL }}" alt="{{ $Text }}" title="{{ $Title }}" loading="lazy" style="max-width: 100%; height: auto;" />
    {{- end }}
{{ end }}