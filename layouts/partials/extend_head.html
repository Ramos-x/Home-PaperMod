{{- /* Head custom content area start */ -}}
{{- /* Insert any custom code (web-analytics, resources, etc.) - it will appear in the

<head></head> section of every page. */ -}}
{{- /* Can be overwritten by partial with the same name in the global layouts. */ -}}


<!-- /* ========== umami  ========== */ -->
<!-- <script defer src="https://cloud.umami.is/script.js" data-website-id="68d10b96-557c-4632-846f-9865e613151c"></script> -->

<!-- 文章字体设置 Fonts -->

<!-- 注释掉现有的 <link> 标签 -->
<!-- <link rel="stylesheet" href="/static/Fonts/lxgw-wenkai-webfont@1.7.0/style.css" /> -->
<!-- <link rel="stylesheet" href="/static/Fonts/lxgw-wenkai-lite-webfont@1.7.0/style.css" /> -->
<!-- <link rel="stylesheet" href="/static/Fonts/lxgw-wenkai-screen-webfont@1.7.0/style.css" /> -->
<!-- <link rel="stylesheet" href="/static/Fonts/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.min.css" /> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.7.0/style.min.css" /> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css" /> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /> -->
<!-- <link rel="preload" href="/static/Fonts/lxgw-wenkai-webfont@1.7.0/style.css" as="style"> -->
<!-- <link rel="preload" href="/static/Fonts/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" as="style"> -->

<!-- 文章字体设置 Fonts -->
<script src="/static/Fonts/webfont.js"></script>
<script>
    WebFont.load({
        custom: {
            families: ['LXGW WenKai', 'JetBrains Mono'],
            urls: [
                '/static/Fonts/lxgw-wenkai-webfont@1.7.0/style.css',
                '/static/Fonts/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css'
            ]
        },
        active: function () {
            // console.log('Fonts have loaded');
            // 在字体加载完成后执行特定的操作
        },
        inactive: function () {
            // console.log('Fonts failed to load');
            // 在字体加载失败后执行特定的操作
        }
    });

      // 注册 Service Worker 并预加载 #menu 下的所有链接
      if ('serviceWorker' in navigator) {
        // console.log('Service Worker is supported.');

        navigator.serviceWorker.register('/static/JS/service-worker.js').then(function (registration) {
            // console.log('Service Worker registered with scope:', registration.scope);
            // console.log(registration);
        }).catch(function (error) {
        //   console.log('Service Worker registration failed:', error);
        });
      } else {
        // console.log('Service Worker is not supported.');
      }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function createSequentialObserver(selector, delay) {
            let elements = Array.from(document.querySelectorAll(selector));
            // 按照元素在页面中的垂直位置排序
            elements.sort((a, b) => {
                return a.getBoundingClientRect().top - b.getBoundingClientRect().top;
            });

            let isAnimating = false;
            let lastAnimatedTop = -Infinity; // 记录最后一个动画元素的位置

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !isAnimating) {
                        isAnimating = true;
                        animateVisibleElements();
                    }
                });
            }, {
                threshold: 0.05
            });

            function animateVisibleElements() {
                // 找出所有在当前视窗上方未动画的元素
                const aboveElements = elements.filter(element => {
                    const rect = element.getBoundingClientRect();
                    return rect.top < window.innerHeight && !element.classList.contains('loaded') && rect.top > lastAnimatedTop;
                });

                if (aboveElements.length === 0) {
                    isAnimating = false;
                    return;
                }

                // 按照位置排序
                aboveElements.sort((a, b) => a.getBoundingClientRect().top - b.getBoundingClientRect().top);

                // 执行第一个元素的动画
                const element = aboveElements[0];
                const rect = element.getBoundingClientRect();
                lastAnimatedTop = rect.top;
                
                element.classList.add('loaded');

                // 继续下一个动画
                setTimeout(() => {
                    animateVisibleElements();
                }, delay);
            }

            // 观察所有元素
            elements.forEach(element => {
                observer.observe(element);
            });

            // 初始检查
            setTimeout(() => {
                if (!isAnimating) {
                    const visibleElement = elements.find(element => {
                        const rect = element.getBoundingClientRect();
                        return rect.top < window.innerHeight && rect.bottom > 0;
                    });

                    if (visibleElement) {
                        isAnimating = true;
                        animateVisibleElements();
                    }
                }
            }, 100);

            // 监听滚动事件，确保新进入视图的元素能够触发动画
            let scrollTimeout;
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (!isAnimating) {
                        const visibleElement = elements.find(element => {
                            const rect = element.getBoundingClientRect();
                            return rect.top < window.innerHeight && rect.bottom > 0 && !element.classList.contains('loaded');
                        });

                        if (visibleElement) {
                            isAnimating = true;
                            animateVisibleElements();
                        }
                    }
                }, 100);
            });
        }

        // 为不同区域的元素创建观察器
        createSequentialObserver('.list > .main > *', 160);
        createSequentialObserver('#top > .main > *', 130);
        createSequentialObserver('.archive-year-header, .archive-month-header, .archive-posts >*', 60);
        createSequentialObserver('.post > *', 190);
    });
</script>
<style>
    /* ========== transition-image ========== */
    #progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 0vmin;
        height: 1px;
        background: linear-gradient(to right, red, orange, yellow, green, blue, indigo);
        z-index: 9000;
        transition: .45s cubic-bezier(0, .5, .5, 1) !important;
    }

    /* @media (prefers-color-scheme: light) {
  #transition-image {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('/static/img/avatar_head.png') no-repeat center center, url('/static/img/grid.png');
    background-size: 15vmin auto, cover;
    z-index: 9000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1;
  }
}
@media (prefers-color-scheme: dark) {
  #transition-image {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('/static/img/avatar_head.png') no-repeat center center, url('/static/img/grid_dark.png');
    background-size: 20% auto, cover;
    z-index: 9000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1;
  }
} */
</style>
{{- /* Head custom content area end */ -}}